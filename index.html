<!DOCTYPE html>
<html lang="es">

<head>
    <title>Calculadora comisiones</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link href="style/main.css" rel="stylesheet">
</head>

<body onload="init();">

    <nav class="navbar navbar-inverse">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>                        
      </button>
                <a class="navbar-brand" href="#">Logo</a>
            </div>
            <div class="collapse navbar-collapse" id="myNavbar">
                <ul class="nav navbar-nav">
                    <li class="active"><a href="#">Home</a></li>
                    <li><a href="#">About</a></li>
                    <li><a href="#">Projects</a></li>
                    <li><a href="#">Contact</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <!--                    <li><a href="#"><span class="glyphicon glyphicon-log-in"></span> Login</a></li>-->
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid text-center">
        <div class="row content">
            <div class="col-sm-2 sidenav">
                <!--                <p><a href="#">Link</a></p>
                <p><a href="#">Link</a></p>
                <p><a href="#">Link</a></p>-->
                <!-- Sidebar Header -->
                <div class="sidebar-header">
                    <h3>Enlaces de interes</h3>
                </div>

                <!-- Sidebar Links -->
                <ul class="list-unstyled components">


                    <li>
                        <!-- Link with dropdown items -->
                        <h4><a href="#linksnoticias" data-toggle="collapse" aria-expanded="false">Noticias</a></h4>
                        <ul class="collapse list-unstyled" id="linksnoticias">
                            <li>
                                <p><a href="https://es.cointelegraph.com/" target="_blank">CoinTelegraph</a></p>
                            </li>
                            <li>
                                <p><a href="https://www.criptonoticias.com/" target="_blank">Criptonoticias</a></p>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <!-- Link with dropdown items -->
                        <h4><a href="#linksexchanges" data-toggle="collapse" aria-expanded="false">Exchanges</a></h4>
                        <ul class="collapse list-unstyled" id="linksexchanges">
                            <li>
                                <p><a href="https://www.binance.com/?ref=15709980" target="_blank">Binance</a></p>
                            </li>
                            <li>
                                <p><a href="https://www.kucoin.com" target="_blank">KuCoin</a></p>
                            </li>
                            <li>
                                <p><a href="https://www.coinbase.com/join/5a3adb48215486013c43c100" target="_blank">Coinbase</a></p>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <!-- Link with dropdown items -->
                        <h4><a href="#linkcalendarios" data-toggle="collapse" aria-expanded="false">Calendarios</a></h4>
                        <ul class="collapse list-unstyled" id="linkcalendarios">
                            <li>
                                <p><a href="https://www.coinmarketcal.com/" target="_blank">CoinMarketCal</a></p>
                            </li>
                            <li>
                                <p><a href="https://cryptocalendar.pro/">CryptoCalendar</a></p>
                            </li>
                            <li>
                                <p><a href="#">Page</a></p>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
            <div class="col-sm-6 text-left">
                <h1>Calculadora</h1>
                <hr>

                <form class="form-horizontal" action="javascript:void(0);">
                    <div class="form-group">
                        <label class="control-label col-sm-2" for="entryprice">P. entrada:</label>
                        <div class="col-sm-10">
                            <input type="number" class="form-control" id="entryprice" placeholder="0">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-2" for="exitprice">P. salida:</label>
                        <div class="col-sm-10">
                            <input type="number" class="form-control" id="exitprice" placeholder="0">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-2" for="comision">% Comisión:</label>
                        <div class="col-sm-10">
                            <input type="number" class="form-control" id="comision" placeholder="%">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-offset-2 col-sm-10">
                            <button class="btn btn-default" onclick="calcular();">Calcular</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-2" for="totalcomision">Comisión:</label>
                        <div class="col-sm-10">
                            <input type="number" class="form-control" id="totalcomision" placeholder="0" disabled>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-2" for="beneficio">Beneficio:</label>
                        <div class="col-sm-10">
                            <input type="number" class="form-control" id="beneficio" placeholder="0" disabled>
                        </div>
                    </div>
                </form>
                <hr>
                <h3>Test</h3>
            </div>
            <div class="col-sm-4 sidenav">
                <div class="well">
                   <h3>Ranking Criptodivisas por volumen</h3>
                   <hr>
                    <table id="tabladivisas" class="table table-striped table-responsive"> </table>
                    <div class="text-right">
                        <p class="fuentepeque">Datos recogidos de <a href="https://coinmarketcap.com/" target="_blank">coinmarketcap</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="container-fluid text-center">
        <div class="col-sm-6 text-left">
            <p>Comision Calc</p>
        </div>
        <div class="col-sm-6 text-right">
            <p>Donate ETH: 0x422e9e72CEfCbcb373a18f9267544B5CCC4933f2</p>
        </div>
    </footer>
    <script type="text/javascript">
        function init(){
            setInterval("recDatosCmc()", 30000);
            recDatosCmc();
        }
        function calcular() {
            entrada = document.getElementById("entryprice").value;
            salida = document.getElementById("exitprice").value;
            comision = document.getElementById("comision").value;
            totalComision = ((parseFloat(entrada) + parseFloat(salida)) * comision) / 100;
            document.getElementById("totalcomision").value = totalComision;
            document.getElementById("beneficio").value = salida - entrada - totalComision;
        }

        function recDatosCmc() {
            // Definimos la URL que vamos a solicitar via Ajax
            var ajax_url = "https://api.coinmarketcap.com/v1/ticker/";

            // Definimos los parámetros que vamos a enviar
            var params = "limit=10";

            // Añadimos los parámetros a la URL
            ajax_url += '?' + params;

            // Creamos un nuevo objeto encargado de la comunicación
            var ajax_request = new XMLHttpRequest();

            // Definimos una función a ejecutar cuándo la solicitud Ajax tiene alguna información
            ajax_request.onreadystatechange = function() {

                // readyState es 4
                if (ajax_request.readyState == 4) {

                    // Analizaos el responseText que contendrá el JSON enviado desde el servidor
                    var jsonObj = JSON.parse(ajax_request.responseText);
                    // La variable jsonObj ahora contiene un objeto con los datos recibidos

                    tabla = document.getElementById("tabladivisas");

                    tablaConDatos = ' <thead><tr><th scope="col">rank</th><th scope="col">name</th><th scope="col">priceUSD</th><th scope="col">change 24h</th></tr></thead><tbody>';
                    for (var i = 0; i < jsonObj.length; i++) {
                        tablaConDatos += '<tr><th scope="row">' + jsonObj[i].rank + '</th><td>' + jsonObj[i].name + '</td><td>' + jsonObj[i].price_usd + '</td><td class="';
                        if (jsonObj[i].percent_change_24h > 0) {
                            tablaConDatos += 'textoverde">' + jsonObj[i].percent_change_24h + '</td></tr>';
                        } else {
                            tablaConDatos += 'textorojo">' + jsonObj[i].percent_change_24h + '</td></tr>';
                        }
                    }
                    tablaConDatos += ' </tbody>';
                    tabla.innerHTML = tablaConDatos;
                }
            }

            // Definimos como queremos realizar la comunicación
            ajax_request.open("GET", ajax_url, true);

            //Enviamos la solicitud
            ajax_request.send();


        }
    </script>
</body>

</html>
